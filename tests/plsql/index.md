---
title: Тестовое задание на позицию PL/SQL разработчика
layout: single-copy
classes: wide
author_profile: true
author: Pavel Shiryaev
---

## Исходные данные

Есть сервер приложений, на котором крутится демон А, готовый принимать из БД 2 типа заданий:

- **ROUTER** - Настройку маршрутизатора
- **SMS** - Отправка СМС сообщений

И есть демон Б, готовый принимать задания

- **SMS** - Отправка СМС сообщений
- **KVSTORE** - Запись пары ключ-значение в другую БД

При чем, каждый из этих демонов многопоточный и высоко параллельный, т.е. выбирает из БД задачи в несколько параллельных сессий, выполняет их, и результаты выполнения пишет тоже параллельно.

В БД есть табличка, хранящая эти задания, выступающая в роли очереди. Вот возможный ее вид

```
create table task_queue(
  task_id    number not null,          -- ID задачи
  task_type  varchar2(20) not null,    -- ROUTER/SMS/KVSTORE
  params     varchar2(1024),           -- строка с параметрами задачи
  ...
);
```

Предположим, что все это довольно нагружено и в очередь каждую секунду падает 30 разных задач.

## Задача

Вам нужно разработать пакет, который бы позволял 

* Создавать новые задания любого из 3-х типов
* Каждому демону подписываться на нужные типы заданий
* Выдавать каждому демону свои задания с указанием типа и строки параметров. При этом, ни в коем случае, нельзя выдать одну задачу сразу двоим или более обработчикам.
* После выполнения задания демон отчитывается о том успешно ли все прошло или нет, поэтому должен быть метод для фиксации результата, просто OK или ERROR
* При ошибке задание нужно попробовать повторить через 10 минут, всего 3 попытки

Вы можете создавать любые объекты БД: таблицы, индексы, констреинты, поля и т.д. task_queue выше приведена чисто для примера, как заготовка, можете ее не использовать.

Ваше решение обязательно должно работать, а не быть просто наброском, мы будем проверять функционирование. И нам интересно, чтобы решение работало максимально эффективно: 
по минимуму терялось время на ожидании блокировок, быстро проверялось наличие задач в очереди и т.д.

Важные места желательно откомментировать, почему так, а не иначе.

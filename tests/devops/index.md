---
title: Тестовое задание на позицию Junior DevOps
layout: single-copy
classes: wide
author_profile: true
author: Pavel Shiryaev
---


## Введение

Рекомендуемое время выполнения: **3 часа**.

Ожидаемый результат: репозиторий на GitHub, либо git репозиторий упакованный в архив переданный в ответе на письмо с заданием.

Можно выполнить любой объём задания.

## Python + Shell

### Задача

Написать shell-скрипт, который обходит текстовые файлы проекта,
заполняет шаблон лицензии для каждого файла, и добавляет лицензию в начало файла.

Заполнять шаблон необходимо при помощи python-скрипта помощника,
который вызывается непосредственно из основного shell-скрипта.

**Сигнатура:**

```bash
./script.sh [-h] [-f путь_к_лицензии] путь_к_проекту
``` 

**Пример вызова helper-скрипта:**

```bash
./insert_license.py --license_path="/путь/к/файлу/лицензии" --filename="имя_файла" --root_folder="корневая папка проекта" --file_owner="имя автора"
```

### Требования к реализации

C точки зрения пользователя, скрипт должен запускаться через командную строку,
c указанием пути к проекту в качестве первого и единственного аргумента.
Должна быть возможность указать путь к файлу лицензии через опциональный параметр (ключ).
По умолчанию скрипт должен искать файл с лицензией в корневой папке, рядом с собой.

Скрипт на питоне только заполняет шаблон, и возвращает текст шаблона со вставленными значениями переменных.
За вставку готовой лицензии в файл отвечает основной shell-скрипт.

Каждая подпрограмма должна умещаться в плюс-минус 50 строк.

**Обязательно:**

 - Использовать `python3`
 - Использовать `bash`, или любой другой `POSIX-compliant shell`
 - Запушить проект на `github.com`
 - Приложение пишем с использованием встроенных библиотек
 - Простые юнит-тесты

**Желательно:**

Оформить как `pip`-пакет, с добавлением в `path` и возможностью запуска через консоль после установки (`setup.py`, `setuptools`, сделать `entrypoint`).

Поощряется кросс-платформенность, проверить на `linux` и `windows`.

Дальше по дополнительным баллам идет `docker`-контейнер, опять же чистенький, с точкой входа,
чтобы можно было запускать приложение через `docker run app`/`docker attach app`.

Подумайте над тем, как хранить данные (`docker-volume`, монтировать директорию).

### Данные

#### Файловая структура проекта

Проект содержит некоторое количество файлов и папок.
Файлы проекта могут быть как текстовыми, так и бинарными - изображения, исполняемые файлы, и т.д.
Необходимо обработать только текстовые файлы похожие на код(html, py, sh, Dockerfile, ... ваши варианты)

[**ссылка на скачивание архива с проектом**](Cufflinks-master.tar.gz)

#### Текстовый файл с шаблоном лицензии проекта

Примерное содержание шаблона:

    Файл: ${filename}
    Проект: ${root_folder}
    Автор: ${file_owner}
    Текст лицензии на ваш выбор

Шаблон по-своему заполняется для каждого файла проекта.

### Технические детали 

Файлы проекта могут содержать `hashbang`, например, `#!/usr/bin/python`, `#!/bin/sh`.
Лицензия должна быть вставлена **после** `hashbang` и **до** всего остального кода.
Если `hashbang` отсутствует, то лицензия должна быть вставлена **в начало файла**.

Минимальный список обрабатываемых расширений - `.py`, `.sh`.
Подумайте над файлами без расширения - а что, если это `Dockerfile`/`Jenkinsfile`/`Makefile`? 

Если вы решите обрабатывать еще какие-либо типы файлов:
 - Для `html`-файлов лицензия должна быть вставлена в `<meta>`.

Если какой-то файл проекта уже содержит лицензию, дописывать еще одну лицензию не нужно -
проверьте, если в файле уже есть лицензия.

В конце, при успешном исполнении вывести количество измененных файлов в `stdout`, список имен и путей в `.log` файл.
При ошибке вывести красивое сообщение об ошибке в `stderr`.

Бонусные очки за удобный интерфейс, подобие тестов, и возможность исполнять на любой Linux-подобной системе.
 
